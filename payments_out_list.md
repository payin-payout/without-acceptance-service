# Метод API для получения списка исходящих платежей

В случае если необходимо получить список исходящих платежей для пользователя можно воспользоваться
данным методом API. Метод возвращает limit платежей начиная от самого свежего.

Необходимо отправить POST - запрос на адрес
https://lk.payin-payout.net/payment-out/get-last-payments-for-user указав следующие параметры:

|Параметр|Значение|Описание|
|---|---|---|
|user_id   | Целое число, например 1111   |Идентификатор пользователя который осуществляет работу с API   |
|timestamp   | Целое число, время Unix в секундах | [Текущее время Unix](calculate-hash.md#Метка-текущего-времени-в-параметрах) в секундах в UTC |
|email   | Строка  |email пользователя   |
|phone   | Строка  |телефон пользователя   |
|limit   | Целое число  |количество платежей, не может быть больше 1000   |
|hash   | Строка  |[Хэш безопасности](calculate-hash.md)   |

### Пример запроса реализованный на PHP

```php
<?php

$paramPost = [
    'user_id' => 7026,
    'email' => 'email@gmail.com',
    'phone' => '9131112233',
    'limit' => 100,
    'timestamp' => time(),
];

uksort($paramPost, 'strcasecmp');
$data_string = http_build_query($paramPost, '', '&');
$hash = hash_hmac('md5', $data_string, 'secret_key');
$paramPost['hash'] = $hash;
$curl = curl_init();
curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
curl_setopt($curl, CURLOPT_HEADER, true);
curl_setopt($curl, CURLOPT_POST, true);
curl_setopt($curl, CURLOPT_POSTFIELDS, $paramPost);
curl_setopt($curl, CURLOPT_URL, 'https://lk.payin-payout.net/payment-out/get-last-payments-for-user');
$out = curl_exec($curl);
echo "\nout:\n$out";
$error = curl_error($curl);
echo "\nerror:\n$error";
```

В случае корректного запроса возвращается ответ:

```json
{
  "status": true,
  "result": [
    {
      "id": 1743599,
      "status": 3,
      "created": "2015-12-30 14:25:37.353059+06",
      "last_update": "2015-12-30 14:36:16+06"
    },
    {
      "id": 1769023,
      "status": 1,
      "created": "2016-01-12 15:40:03.918944+06",
      "last_update": "2016-01-12 15:41:28+06"
    }
  ],
  "tracker": " gid_5d5b9950e239b8.22633142"
}
```

### Описание данных в ответе

|Параметр|Значение|Описание|
|---|---|---|
|status   | логическое значения   |определяет успешность операции  |
|result   |массив со списком платежей   |список платежей  |
|id   |идентификатор платежа   |параметр однозначно идентифицирующий платёж   |
|status   |статус платежа   |статус в котором в данный момент находится платёж   |
|created   |Время создания платежа   |Время создания платежа   |
|last_update   |Время последнего обновления состояния платежа   |Время последнего обновления состояния платежа   |

### Список статусов платежей

|Статус|Описание|
|---|---|
|0   |Новый платёж, только что создан
|1   |Платёж успешно оплачен
|2   |Платёж отменён
|3   |Платёж упал в ошибку
|5   |Некорректная ситуация во время проведения, необходимо обратиться в поддержку
|8   |Произведён возврат платежа
