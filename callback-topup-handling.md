# Обработка уведомления о успешном пополнении баланса

После того как был [создан счёт для пополнения баланса](create-invoice.md) и пользователь успешно его оплатил,
в случае если в настройках системы Payin-payout указан адрес (для указания соответствующей настройки необходимо 
обратиться к менеджменту) для отправки уведомлений о пополнении баланса, отправляется callback.

Запрос передаётся методом POST, в payload содержится json c данными:

```json
{
  "payment_in_id": 64522147743974,
  "payment_in_status": 1,
  "timestamp": 1563956853,
  "tracker": " gid_5d380ab2e9f389.90807715",
  "hash": "a084b75e4eb09627b83889159a573353"
}
```

При обработке данных в целях безопасности следует проверить подпись, которая 
[формируется аналогично](calculate-hash.md) случаю с отправкой данных в систему Payin-payout.

В расчёте подписи используются данные в том порядке в каком они присутствуют в запросе. Из расчёта
исключаются параметры hash и tracker.

Запрос передаётся на адрес который необходимо сообщить менеджменту системы Payin-payout, с уточнением что этот адрес
обрабатывает уведомления именно о пополнении баланса. В настройках системы Payin-payout адрес для отправки [уведомления
о успешном автоматическом списании](callback-handling.md) и адрес описываемого здесь уведомления это отдельные настройки.

### Данные передаваемые при уведомлении

|Параметр|Значение|Описание|
|---|---|---|
|payment_in_id  |Целое число |Идентификатор входящего платежа в рамках которого зачислились средства в личном кабинете владельца магазина |
|payment_in_status  |Целое число |Статус входящего платежа, в нормальной ситуации всегда должен быть равен 1, если был передан иной статус следует обратиться в техподдержку |
|timestamp   | Целое число, время Unix в секундах | [Текущее время Unix](calculate-hash.md#Метка-текущего-времени-в-параметрах) в секундах в UTC |
|tracker   |строка   |служебная информация   |
|hash   | Строка  |[Хэш безопасности](calculate-hash.md)   |

### Метка текущего времени в параметрах

При обработке уведомления необходимо проверять корректность timestamp которое не должно существенно
отличаться от текущего времени. Это необходимо для избежания либо некорректных запросов, либо запросов
отправляемых злоумышленниками которые каким-либо образом смогли получить данные ранее отправленных запросов.

### Ответ на уведомление

В случае успешной обработки уведомления система партнёра должна вернуть HTTP код 200 и json
в котором будет присутсвовать параметр result со значением true:

```json
{ 
  "result": true
}
```

Если будет получен другой ответ, то будет считаться что система партнёра не смогла корректно
обработать уведомление и позднее будет совершена повторная попытка.
