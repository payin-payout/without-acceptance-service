# Метод API для получения информации о исходящем платеже

В случае если необходимо получить информацию о статусе исходящего платежа, можно воспользоваться
данным методом API. В случае если платёж с указанным номером счёта найден, метод возвращает статус платежа.

Необходимо отправить POST - запрос на адрес
https://lk.payin-payout.net/payment-out/find-payment указав следующие параметры:

|Параметр|Значение|Описание|
|---|---|---|
|user_id   | Целое число, например 1111   |Идентификатор пользователя который осуществляет работу с API   |
|timestamp   | Целое число, время Unix в секундах | [Текущее время Unix](calculate-hash.md#Метка-текущего-времени-в-параметрах) в секундах в UTC |
|account_number   | Номер счёта  |Номер счёта вида 007026-030254  |
|hash   | Строка  |[Хэш безопасности](calculate-hash.md)   |

### Пример запроса реализованный на PHP

```php
<?php

$paramPost = [
    'user_id' => 1111,
    'account_number' => '007026-030254',
    'timestamp' => time(),
];

$hash = hash_hmac('md5', implode($paramPost), 'secret_key');
$paramPost['hash'] = $hash;
$curl = curl_init();
curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
curl_setopt($curl, CURLOPT_HEADER, true);
curl_setopt($curl, CURLOPT_POST, true);
curl_setopt($curl, CURLOPT_POSTFIELDS, $paramPost);
curl_setopt($curl, CURLOPT_URL, 'https://lk.payin-payout.net/payment-out/find-payment');
$out = curl_exec($curl);
echo "\nout:\n$out";
$error = curl_error($curl);
echo "\nerror:\n$error";
```

В случае корректного запроса возвращается ответ:

```json
{
  "status": true,
  "result": {
    "account_number": "007026-030254",
    "client_status": 0,
    "system_status": 1,
    "last_update_time": null
  },
  "tracker": " gid_5d9d570075fd75.41113509"
}
```

В случае если платёж не был найден, будет возвращена ошибка:

```json
{
  "status": false,
  "user_msg": "Payment with account number 007026-030333 not found",
  "tracker": " gid_5d9d61dbecf396.38884455"
}
```

### Описание данных в ответе

|Параметр|Значение|Описание|
|---|---|---|
|status   | логическое значения   |определяет успешность операции  |
|result   |массив со списком платежей   |список платежей  |
|account_number   |номер счёта   |номер счёта, совпадает с номером в запросе   |
|client_status   |статус платежа   |статус который отображается в ЛК клиента   |
|system_status   |статус платежа   |более детализированная информация о статусе платежа   |
|last_update_time   |Время последнего обновления состояния платежа   |Время последнего обновления состояния платежа, если платёж не начинал обрабатываться, может быть null   |

### Список статусов платежей в ЛК клиента

|Статус|Описание|
|---|---|
|0   |Новый платёж, только что создан
|1   |Платёж успешно оплачен
|2   |Платёж отменён
|3   |Платёж упал в ошибку
|5   |Некорректная ситуация во время проведения, необходимо обратиться в поддержку
|8   |Произведён возврат платежа

### Детализованный список статусов платежей

Представляет собой довольно большой список, при возникновении вопросов по этому статусу следует обратиться в поддержку.
